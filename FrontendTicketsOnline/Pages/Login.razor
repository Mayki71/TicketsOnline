@page "/login"
@inject IAuthService AuthService
@inject NavigationManager Nav

<div class="max-w-md mx-auto mt-20 p-8 bg-white rounded-xl shadow-lg border">
    <h2 class="text-3xl font-bold mb-6 text-center text-indigo-700">Iniciar Sesión</h2>

    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="p-3 mb-4 bg-red-100 border border-red-300 text-red-700 rounded">
            @errorMessage
        </div>
    }

    <EditForm Model="@loginDto" OnValidSubmit="HandleLogin">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-4">
            <label class="block font-medium mb-1">Email</label>
            <InputText class="w-full p-2 border rounded" @bind-Value="loginDto.Email" />
        </div>

        <div class="mb-4">
            <label class="block font-medium mb-1">Contraseña</label>
            <InputText class="w-full p-2 border rounded" type="password" @bind-Value="loginDto.Password" />
        </div>

        <button type="submit"
                class="w-full bg-indigo-600 text-white p-2 rounded hover:bg-indigo-700 transition">
            Ingresar
        </button>
    </EditForm>
</div>

@code {
    private LoginDto loginDto = new();
    private string errorMessage;

    private async Task HandleLogin()
    {
        errorMessage = "";

        // Login devuelve bool → true = ok ; false = error
        bool ok = await AuthService.Login(
            loginDto.Email,
            loginDto.Password
        );

        if (!ok)
        {
            errorMessage = "Credenciales incorrectas";
            return;
        }

        Nav.NavigateTo("/");
    }


}
